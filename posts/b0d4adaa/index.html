<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Linux系统调优及安全设置 | Dear</title><meta name="description" content="关闭SELinux​        大多数生产环境都是直接将其关闭，至于安全问题，后面可以用iptables类似手段来解决. 修改配置文件，永久关闭SELinux 1[root@localhost ~]# sed -i &#39;s&#x2F;SELINUX&#x3D;enforcing&#x2F;SELINUX&#x3D;disabled&#x2F;&#39; &#x2F;etc&#x2F;sysconfig&#x2F;selinux  配置该文件可永久关闭SELinux，但必须得重启才能"><meta name="keywords" content="安全,调优"><meta name="author" content="Chen Huihuang"><meta name="copyright" content="Chen Huihuang"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Linux系统调优及安全设置"><meta name="twitter:description" content="关闭SELinux​        大多数生产环境都是直接将其关闭，至于安全问题，后面可以用iptables类似手段来解决. 修改配置文件，永久关闭SELinux 1[root@localhost ~]# sed -i &#39;s&#x2F;SELINUX&#x3D;enforcing&#x2F;SELINUX&#x3D;disabled&#x2F;&#39; &#x2F;etc&#x2F;sysconfig&#x2F;selinux  配置该文件可永久关闭SELinux，但必须得重启才能"><meta name="twitter:image" content="http://img.stupy.xyz/PicGo/bg3.jpg"><meta property="og:type" content="article"><meta property="og:title" content="Linux系统调优及安全设置"><meta property="og:url" content="http://yoursite.com/posts/b0d4adaa/"><meta property="og:site_name" content="Dear"><meta property="og:description" content="关闭SELinux​        大多数生产环境都是直接将其关闭，至于安全问题，后面可以用iptables类似手段来解决. 修改配置文件，永久关闭SELinux 1[root@localhost ~]# sed -i &#39;s&#x2F;SELINUX&#x3D;enforcing&#x2F;SELINUX&#x3D;disabled&#x2F;&#39; &#x2F;etc&#x2F;sysconfig&#x2F;selinux  配置该文件可永久关闭SELinux，但必须得重启才能"><meta property="og:image" content="http://img.stupy.xyz/PicGo/bg3.jpg"><meta property="article:published_time" content="2020-04-10T01:29:36.000Z"><meta property="article:modified_time" content="2020-05-08T02:08:44.471Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="canonical" href="http://yoursite.com/posts/b0d4adaa/"><link rel="prev" title="Vmware启动黑屏补救数据" href="http://yoursite.com/posts/692cdb86/"><link rel="next" title="ssh连接原理及排错" href="http://yoursite.com/posts/a1303e41/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: {"text":"富強,民主,文明,和諧,自由,平等,公正,法治,愛國,敬業,誠信,友善","fontSize":"15px"},
  medium_zoom: false,
  fancybox: true,
  Snackbar: {"bookmark":{"message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">10</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">10</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">4</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 時間轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-heartbeat" aria-hidden="true"></i><span> 清单</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/Gallery/"><i class="fa-fw fa fa-picture-o"></i><span> 照片</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#关闭SELinux"><span class="toc-number">1.</span> <span class="toc-text">关闭SELinux</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#设定运行级别"><span class="toc-number">2.</span> <span class="toc-text">设定运行级别</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#精简开机系统自启动"><span class="toc-number">3.</span> <span class="toc-text">精简开机系统自启动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Linux系统安全最小原则"><span class="toc-number">4.</span> <span class="toc-text">Linux系统安全最小原则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SSH服务器端配置"><span class="toc-number">5.</span> <span class="toc-text">SSH服务器端配置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#更改SSH服务器端设置"><span class="toc-number">5.1.</span> <span class="toc-text">更改SSH服务器端设置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SSH更加高级策略"><span class="toc-number">5.2.</span> <span class="toc-text">SSH更加高级策略</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sudo控制权限"><span class="toc-number">6.</span> <span class="toc-text">sudo控制权限</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#时间同步"><span class="toc-number">7.</span> <span class="toc-text">时间同步</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#历史记录数及登录超时环境变量设置"><span class="toc-number">8.</span> <span class="toc-text">历史记录数及登录超时环境变量设置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#设置闲置账号超时时间"><span class="toc-number">8.1.</span> <span class="toc-text">设置闲置账号超时时间</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#设置Linux的命令行历史记录数"><span class="toc-number">8.2.</span> <span class="toc-text">设置Linux的命令行历史记录数</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#调整Linux系统文件描述符数量"><span class="toc-number">9.</span> <span class="toc-text">调整Linux系统文件描述符数量</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#调整方法一"><span class="toc-number">9.1.</span> <span class="toc-text">调整方法一</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#调整方法二"><span class="toc-number">9.2.</span> <span class="toc-text">调整方法二</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#内核参数优化"><span class="toc-number">10.</span> <span class="toc-text">内核参数优化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#定时清理邮件垃圾"><span class="toc-number">11.</span> <span class="toc-text">定时清理邮件垃圾</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#锁定关键系统文件"><span class="toc-number">12.</span> <span class="toc-text">锁定关键系统文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#禁止Linux系统被ping"><span class="toc-number">13.</span> <span class="toc-text">禁止Linux系统被ping</span></a></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(http://img.stupy.xyz/PicGo/bg3.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Dear</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 時間轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-heartbeat" aria-hidden="true"></i><span> 清单</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/Gallery/"><i class="fa-fw fa fa-picture-o"></i><span> 照片</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">Linux系统调优及安全设置</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-04-10 09:29:36"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-04-10</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-05-08 10:08:44"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-05-08</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Linux/">Linux</a></span></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h4 id="关闭SELinux"><a href="#关闭SELinux" class="headerlink" title="关闭SELinux"></a>关闭SELinux</h4><p>​        大多数生产环境都是直接将其关闭，至于安全问题，后面可以用iptables类似手段来解决.</p>
<p>修改配置文件，永久关闭SELinux</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# sed -i 's/SELINUX=enforcing/SELINUX=disabled/' /etc/sysconfig/selinux</span><br></pre></td></tr></table></figure>

<p>配置该文件可永久关闭SELinux，但必须得重启才能读取到该配置</p>
<p>临时关闭SELinux</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# setenforce 0   临时将SELinux调成Permissive</span><br><span class="line">[root@localhost ~]# getenforce     通过该命令获取SELinux的当前状态</span><br><span class="line">Permissive</span><br></pre></td></tr></table></figure>

<p><strong>提示：修改配置SELinux后，要想使其生效，必须要重启系统。因此，可配合使用setenforce 0这个临时使其关闭的命令，这样在重启前后都可以使SELinux关闭生效，也就是说无须立刻重启服务器了，在生产场景下Linux机器是不能随意重启的</strong></p>
<h4 id="设定运行级别"><a href="#设定运行级别" class="headerlink" title="设定运行级别"></a>设定运行级别</h4><p>​        设定运行级别（runlevel）为3，即表示使用文本命令行模式管理Linux，若一开始安装系统的时候选择的是Minimal install，则可跳过该步骤，检查命令如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# runlevel 				#查看系统的运行级别</span><br><span class="line">N 3</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# init 5					#修改系统的运行级别为5,即桌面环境，只有在安装了桌面程序时才可以执行startx命令切换</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>命令说明</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">runlevel：查看当前系统运行级别</span><br><span class="line"></span><br><span class="line">init ：切换运行级别，后面接对应级别的数字，例如：init 6就是重启Linux服务器</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>系统的7种运行级别</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">运行级别0：系统停机状态，系统默认运行级别不能设为0，否则不能正常启动 </span><br><span class="line">运行级别1：单用户工作状态，root权限，用于系统维护，禁止远程登陆 </span><br><span class="line">运行级别2：无网络支持的多用户状态(没有NFS) </span><br><span class="line">运行级别3：完全的多用户状态(有NFS)，登陆后进入控制台命令行模式 </span><br><span class="line">运行级别4：系统未使用，保留 </span><br><span class="line">运行级别5：X11控制台，登陆后进入图形GUI模式 ，即桌面模式</span><br><span class="line">运行级别6：系统正常关闭并重启，默认运行级别不能设为6，否则不能正常启动</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>Linux系统从开机到登录之前的启动流程</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">(1)开机BIOS自检，加载硬盘</span><br><span class="line"></span><br><span class="line">(2)读取MBR,MBR引导</span><br><span class="line"></span><br><span class="line">(3)grub引导菜单(Boot Loader),引导装载程序</span><br><span class="line"></span><br><span class="line">(4)加载内核kernel</span><br><span class="line"></span><br><span class="line">(5)启动init (centos7 为systemd) 进程，依据inittab文件设定运行级别</span><br><span class="line"></span><br><span class="line">(6)init进程，执行rc.sysinit文件</span><br><span class="line"></span><br><span class="line">(7)启动内核模块，执行不同级别的脚本程序</span><br><span class="line"></span><br><span class="line">(8)执行不同运行级别的脚本程序,即&#x2F;etc&#x2F;rc[0-6].d&#x2F;下的脚本</span><br><span class="line"></span><br><span class="line">(9)执行&#x2F;etc&#x2F;rc.d&#x2F;rc.local</span><br><span class="line"></span><br><span class="line">(10)启动mingetty，进入系统登陆界面</span><br></pre></td></tr></table></figure>



<h4 id="精简开机系统自启动"><a href="#精简开机系统自启动" class="headerlink" title="精简开机系统自启动"></a>精简开机系统自启动</h4><p>​        与Windows系统一样，在Linux服务器运行的过程中，也会有很多无用的软件服务默认运行，这些服务占用了很多系统资源，而且也带来了安全隐患，因此要关闭</p>
<p>(1)重要的开机自启动服务</p>
<p>​    企业环境新装Linux系统之后有必要保留的开机自启动服务有5个，具体如下</p>
<ul>
<li><strong>sshd</strong>：远程连接Linux服务器时需要用到这个服务程序，所以必须要开启，否则Linux服务器就无法提供远程连接服务了。</li>
<li><strong>rsyslog</strong>：日志相关软件，这是操作系统提供的一种机制，系统的守护程序通常会使用rsyslog程序将各种信息写到各个系统日志文件中，在CentOS 6以前此服务的名字为syslog。</li>
<li><strong>network</strong>：系统启动时，若想激活/关闭各个网络接口，则应（必须）考虑开启此服务。</li>
<li><strong>crond</strong>：该服务用于周期性地执行系统及用户配置的任务计划。有要周期性执行的任务时，就要开启，此服务几乎是生产场景必须要用的一个软件。</li>
<li><strong>sysstat</strong>：sysstat是一个软件包，包含监测系统性能及效率的一组工具，这些工具对于我们收集系统性能数据很有帮助，比如CPU使用率、硬盘和网络吞吐数据等，对这些数据的收集和分析，有利于判断系统运行是否正常，所以它是提高系统运行效率、安全运行服务器的得力助手。</li>
</ul>
<p>sysstat软件包集成的主要工具为：</p>
<ul>
<li><strong>iostat</strong>工具提供CPU使用率及硬盘吞吐效率的数据。</li>
<li><strong>mpstat</strong>工具提供与单个或多个处理器相关的数据。</li>
<li><strong>sar</strong>工具负责收集、报告并存储系统活跃的信息。</li>
</ul>
<p><strong>提示：上述5个服务是安装完系统后建议保留的开机自启动服务，也几乎是一切生产服务器必须保留的开机自启动服务。将来还可以根据服务器的业务使用场景调整相应的自启动服务</strong></p>
<p><strong>CentOS7已不再使用chkconfig管理启动项</strong></p>
<p>(2)查看开机启动项</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# systemctl list-unit-files | grep enabled </span><br><span class="line">auditd.service                                enabled </span><br><span class="line">autovt@.service                               enabled </span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>可通过 <code>systemctl disable 服务名</code>关闭开机自启，前提是 <code>/usr/lib/systemd/system/</code> 文件夹下有该服务的文件，即  <code>服务名.service</code>，例如</p>
<blockquote>
<p>nginx.service</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=nginx - high performance web server</span><br><span class="line">After=network.target remote-fs.target nss-lookup.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf</span><br><span class="line">ExecReload=/usr/local/nginx/sbin/nginx -s reload</span><br><span class="line">ExecStop=/usr/local/nginx/sbin/nginx -s stop</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>



<h4 id="Linux系统安全最小原则"><a href="#Linux系统安全最小原则" class="headerlink" title="Linux系统安全最小原则"></a>Linux系统安全最小原则</h4><p>具体包括如下几个方面：</p>
<ul>
<li>安装Linux系统最小化，即选包最小化，yum安装软件包也要最小化，无用的包不装。</li>
<li>开机自启动服务最小化，即无用的服务不开启。</li>
<li>操作命令最小化。例如：能用“rm-f test.txt”就不用“rm-fr test.txt”。</li>
<li>登录Linux用户最小化。平时没有特殊需求不登录root，用普通用户登录即可。</li>
<li>普通用户授权权限最小化，即只给用户必需的管理系统的命令。</li>
<li>Linux系统文件及目录的权限设置最小化，禁止随意创建、更改、删除文件。</li>
</ul>
<h4 id="SSH服务器端配置"><a href="#SSH服务器端配置" class="headerlink" title="SSH服务器端配置"></a>SSH服务器端配置</h4><h5 id="更改SSH服务器端设置"><a href="#更改SSH服务器端设置" class="headerlink" title="更改SSH服务器端设置"></a>更改SSH服务器端设置</h5><p>Windows服务器的默认远程管理端口是3389，管理员用户是administrator，普通用户是guest。Linux的管理用户是root，普通用户默认有很多个，远程连接默认端口22</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vim /etc/ssh/sshd_config				#更改如下几个参数</span><br><span class="line">Port 51523</span><br><span class="line">PermitRootLogin no</span><br><span class="line">PermitEmptyPasswords no</span><br><span class="line">UseDNS no</span><br><span class="line">GSSAPIAuthentication no</span><br></pre></td></tr></table></figure>

<p>相关参数说明如下图</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://img.stupy.xyz/PicGo/sshd.jpg" alt=""></p>
<p>注:Linux下SSH远程连接服务慢的解决方案<a href="http://oldboy.blog.51cto.com/2561410/1300964" target="_blank" rel="noopener">http://oldboy.blog.51cto.com/2561410/1300964</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# systemctl reload sshd</span><br></pre></td></tr></table></figure>

<p><strong>提示: <code>reload</code>为平滑重启，不影响正在SSH连接的其他用户，因此要好于<code>restart</code></strong></p>
<h5 id="SSH更加高级策略"><a href="#SSH更加高级策略" class="headerlink" title="SSH更加高级策略"></a>SSH更加高级策略</h5><p>更改SSH监听的IP，使其仅监听内网IP。命令如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# sed -n '13,20p' /etc/ssh/sshd_config</span><br><span class="line"><span class="meta">#</span><span class="bash"> If you want to change the port on a SELinux system, you have to tell</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> SELinux about this change.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> semanage port -a -t ssh_port_t -p tcp <span class="comment">#PORTNUMBER</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">Port 22</span></span><br><span class="line"><span class="meta">#</span><span class="bash">AddressFamily any</span></span><br><span class="line">ListenAddress 10.3.138.5				#企业仅指定监听本机内网IP地址</span><br><span class="line"><span class="meta">#</span><span class="bash">ListenAddress ::</span></span><br></pre></td></tr></table></figure>

<p>上面修改监听的IP地址，让sshd只监听内网ip，但是这样只有内网ip才能登陆ssh。但是这样的话就不能远程维护服务器了</p>
<p>通过防火墙限制仅能使用内网IP连接此服务器。限制命令如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# iptables -I INPUT -p tcp --dport 51523 -s 10.0.0.0/24 -j ACCEPT</span><br><span class="line">[root@localhost ~]# iptables -A INPUT -j DROP			#拒绝所有端口访问</span><br></pre></td></tr></table></figure>



<p>互联网TCP/IP连接、对外的Web服务器端口http 80和https 443的安全控制</p>
<h4 id="sudo控制权限"><a href="#sudo控制权限" class="headerlink" title="sudo控制权限"></a>sudo控制权限</h4><p>为了安全及管理的方便，可将需要root权限的普通用户加入sudo管理，这样用户就可以通过自己的普通账户登录，利用root的权限来管理系统了，当然也就不需要有root账号及密码了。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# visudo				#相当于编辑/etc/sudoers文件</span><br></pre></td></tr></table></figure>

<p>找到下列几行(大概在99行)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Allow root to run any commands anywhere</span></span></span><br><span class="line">root    ALL=(ALL)       ALL</span><br><span class="line">test    ALL=(ALL)		/usr/sbin/useradd,!/usr/sbin/userdel		#控制用户所能使用的命令</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>语法</strong></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">授权用户/组 主机=[(切换到哪些用户或组)] [是否需要输入密码验证:]命令1,命令2,...</span><br><span class="line">user    MACHINE=COMMANDS      		 # sudo 语法</span><br><span class="line"></span><br><span class="line">root    ALL=(ALL)       ALL          # (All)表示允许用户以哪个用户的权限做事情</span><br><span class="line">omd     ALL=(ALL)       ALL       	 #omd用户在任何机器上，可以只需任何用户的任何命令,相当于root用户</span><br><span class="line">omd     ALL=(ALL)     NOPASSWD: ALL  	#免密而且omd用户在任何机器上，可以只需任何用户的任何命令,若用了,分开命令，则NOPASSWD:只影响了其后的第一个命令: 命令1.</span><br><span class="line">ftl     ALL=(ALL)   /bin/cp,/bin/touch   # 只允许ftl用户只需root用户的cp,touch命令</span><br></pre></td></tr></table></figure>

<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://img.stupy.xyz/PicGo/sudo.jpg" alt=""></p>
<p><strong>提示：如果oldboy用户被授予上述权限，那么它可在所有的机器上以所有的角色运行useradd、userdel命令</strong></p>
<p>如果是针对用户组，则对应的授权命令如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">%</span><span class="bash">用户组  机器=（授权使用哪个角色的权限）/usr/sbin/useradd</span></span><br><span class="line"></span><br><span class="line"><span class="meta">%</span><span class="bash">wheel  ALL=(ALL)       ALL</span></span><br></pre></td></tr></table></figure>

<p><strong>通过sudo进行授权管理系统的目的：既能让运维人员干活，又不能让其威胁系统安全，其实就是前面讲的用户权限最小化原则，还可以审计用户使用sudo的提权操作命令</strong></p>
<p>上面配置完成之后，需要通过命令检查是否语法有错误</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# visudo -c</span><br><span class="line">/etc/sudoers: parsed OK</span><br></pre></td></tr></table></figure>

<p><strong>说明:</strong></p>
<ul>
<li><strong>通过sudo授权管理后，所有用户执行授权的特殊权限格式为“sudo命令”。</strong></li>
<li><strong>如果需要切换到root执行相关操作，可以通过“sudo su-”命令，注意，此命令提示的密码为当前用户的密码，而不是root的密码。</strong></li>
<li><strong>执行“<code>sudo -l</code>”命令可以查看当前用户被授予的sudo权限集合。如下</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[chen@localhost ~]$ sudo -l</span><br><span class="line">Matching Defaults entries for chen on localhost:</span><br><span class="line">    !visiblepw, always_set_home, match_group_by_gid, always_query_group_plugin, env_reset, env_keep="COLORS DISPLAY HOSTNAME HISTSIZE</span><br><span class="line">    KDEDIR LS_COLORS", env_keep+="MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE", env_keep+="LC_COLLATE LC_IDENTIFICATION</span><br><span class="line">    LC_MEASUREMENT LC_MESSAGES", env_keep+="LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE", env_keep+="LC_TIME LC_ALL LANGUAGE</span><br><span class="line">    LINGUAS _XKB_CHARSET XAUTHORITY", secure_path=/sbin\:/bin\:/usr/sbin\:/usr/bin</span><br><span class="line"></span><br><span class="line">User chen may run the following commands on localhost:</span><br><span class="line">    (ALL) /usr/bin/ls</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>对于Linux系统bash的内置命令，一般无法进行sudo授权，例如cd命令</strong></li>
</ul>
<p>sudo授权与su切换的原理如下图</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://img.stupy.xyz/PicGo/sudos.jpg" alt=""></p>
<p>​        <strong>在生产环境中，通常会禁止root远程登录，不过，会为每个运维人员建立一个普通账号，然后根据运维人员的需求，通过sudo控制登录系统的权限，事实证明这是一个不错的权限管理方式。也可在生产环境中使用了<code>ldap统一认证登录及授权管理</code>的方式。即只要有一个账号和密码，全公司多个机房系统内通行无阻（系统登录、SVN、VPN等）</strong></p>
<h4 id="时间同步"><a href="#时间同步" class="headerlink" title="时间同步"></a>时间同步</h4><p>​    Linux系统的时间同步服务为ntp服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# rpm -qa ntpdate					#查询服务器是否已安装了ntpdate服务</span><br><span class="line">ntpdate-4.2.6p5-29.el7.centos.x86_64</span><br></pre></td></tr></table></figure>

<p>手动同步互联网时间到本地Linux主机</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ntpdate ntp.aliyun.com					</span><br><span class="line">16 Apr 10:53:40 ntpdate[8179]: adjust time server 203.107.6.88 offset 0.005501 sec</span><br></pre></td></tr></table></figure>

<p>利用定时任务crond把上述的命令每5分钟自动执行一次</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# echo '#time sync by chen at 2020-04-16' &gt;&gt; /var/spool/cron/root</span><br><span class="line">[root@localhost ~]# echo '*/5 * * * *  /usr/sbin/ntpdate ntp.aliyun.com &gt;/dev/null 2&gt;&amp;1' &gt;&gt; /var/spool/cron/root 				#编写一个定时任务，每5分钟同步一次时间</span><br></pre></td></tr></table></figure>

<p><strong>注：在机器数量少时，可利用以上定时任务进行互联网时间同步，如果机器数量大，那么最好是在网内部署一个时间同步服务器ntp server，然后让自己的网内服务器的时间都与ntpserver同步就可以了</strong></p>
<p>（1）小规模时间同步架构可如下图所示，即网络内部不搭建时间服务器了，所有内部服务器都同步外部互联网已有的时间服务器</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://img.stupy.xyz/PicGo/ntp1.jpg" alt=""></p>
<p>（2）大规模集群时间同步架构如下图所示，其中ntpserver1和ntpserver2互备，为内部的时间服务器，由这两台服务器与外部时间服务器时间同步，然后内部的所有服务器都与ntpserver1和ntpserver2进行时间同步</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://img.stupy.xyz/PicGo/ntp2.jpg" alt=""></p>
<h4 id="历史记录数及登录超时环境变量设置"><a href="#历史记录数及登录超时环境变量设置" class="headerlink" title="历史记录数及登录超时环境变量设置"></a>历史记录数及登录超时环境变量设置</h4><h5 id="设置闲置账号超时时间"><a href="#设置闲置账号超时时间" class="headerlink" title="设置闲置账号超时时间"></a>设置闲置账号超时时间</h5><p>设置闲置账号超时时间的示例命令如下，注意此处的配置仅临时生效</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# export TMOUT=10					#10秒后自动断开</span><br></pre></td></tr></table></figure>

<p>若需一直生效的，则可在 <code>/etc/profile</code>文件里追加</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TMOUT=1000										#1000秒后自动断开</span><br></pre></td></tr></table></figure>



<h5 id="设置Linux的命令行历史记录数"><a href="#设置Linux的命令行历史记录数" class="headerlink" title="设置Linux的命令行历史记录数"></a>设置Linux的命令行历史记录数</h5><p>设置Linux命令行的历史记录数<code>输出行数</code> 示例命令如下，注意此处的配置仅临时生效</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ecport HISTSIZE=1000		#使用history命令只能输出1000行历史记录</span><br></pre></td></tr></table></figure>



<p>设定用户的命令行历史记录文件（~/.bash_history）<code>记录指定命令数量</code>的示例命令如下，注意此处的配置仅临时生效</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# export HISTFILESIZE=1000	#该~/.bash_history文件下只保留1000行历史记录</span><br></pre></td></tr></table></figure>



<blockquote>
<p>重点</p>
</blockquote>
<ul>
<li>HISTFILESIZE 定义了在 .bash_history 中保存命令的记录总数道</li>
<li>HISTSIZE 定义了 history 命令输出的记录数</li>
</ul>
<p>永久生效,即将参数写入到<code>/etc/profile</code>文件下，则执行下面命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# echo 'HISTSIZE=1000' &gt;&gt; /etc/profile</span><br><span class="line">[root@localhost ~]# echo 'HISTFILESIZE=1000' &gt;&gt; /etc/profile</span><br></pre></td></tr></table></figure>



<blockquote>
<p>参数解释</p>
</blockquote>
<ul>
<li>TMOUT=10：连接的超时时间控制变量。</li>
<li>HISTSIZE=5：命令行的历史记录数量变量。</li>
<li>HISTFILESIZE=10：历史记录文件的命令数量变量（~/.bash_history）</li>
</ul>
<p><strong>提示：实际工作中类似的变量还有不少，大家可以根据企业工作需求选择使用，最好执行前加上export命令。更多Linux系统的环境变量，大家可以执行man bash查询。</strong></p>
<h4 id="调整Linux系统文件描述符数量"><a href="#调整Linux系统文件描述符数量" class="headerlink" title="调整Linux系统文件描述符数量"></a>调整Linux系统文件描述符数量</h4><p>​        <strong>文件描述符是由无符号整数表示的句柄，进程使用它来标识打开的文件。</strong>文件描述符与包括相关信息（如文件的打开模式、文件的位置类型、文件的初始类型等）的文件对象相关联，这些信息被称作文件的上下文。文件描述符的有效范围是0到OPEN_MAX。</p>
<p>​        <strong>对于内核而言，所有打开的文件都是通过文件描述符引用的。当打开一个现有文件或创建一个新文件时，内核向进程返回一个文件描述符。当读或写一个文件时，使用open或creat返回的文件描述符标识该文件，并将其作为参数传递给read或write，文件描述符定义的内容如下。</strong></p>
<p>查看Linux服务器文件描述符设置的情况可以使用ulimit-n命令，文件描述符大小默认是1024</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost chen]# ulimit -n</span><br><span class="line">1024</span><br></pre></td></tr></table></figure>

<p><strong>对于高并发的业务Linux服务器来说，这个默认的设置值是不够的，需要调整</strong></p>
<h5 id="调整方法一"><a href="#调整方法一" class="headerlink" title="调整方法一"></a>调整方法一</h5><p>​    </p>
<p>在<code>/etc/security/limits.conf</code>该文件末尾追加命令，如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost chen]# vim /etc/security/limits.conf</span><br><span class="line">*                -       nofile          65535					#追加该命令</span><br></pre></td></tr></table></figure>

<p>加入后，重新登录即可</p>
<h5 id="调整方法二"><a href="#调整方法二" class="headerlink" title="调整方法二"></a>调整方法二</h5><p>直接把ulimit-SHn 65535命令加入/etc/rc.local，用以设置每次开机启动时配置生效，命令如下。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat &gt;&gt;/etc/rc.local&lt;&lt;EOF</span><br><span class="line"><span class="meta">#</span><span class="bash">-S use the <span class="string">'soft'</span> resource <span class="built_in">limit</span>	警告的设定，可以超过这个设定值，但是若超过则有警告信息</span></span><br><span class="line"><span class="meta">#</span><span class="bash">-H  use the <span class="string">'hard'</span> resource <span class="built_in">limit</span>	严格的设定，必定不能超过这个设定的数值</span></span><br><span class="line"><span class="meta">#</span><span class="bash">-n  the maximum number of open file descriptors</span></span><br><span class="line">ulimit -HSn 65535</span><br><span class="line"><span class="meta">#</span><span class="bash">-s the maximum stack size</span></span><br><span class="line">ulimit -s 65535</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>



<h4 id="内核参数优化"><a href="#内核参数优化" class="headerlink" title="内核参数优化"></a>内核参数优化</h4><p><strong>所谓Linux服务器内核参数优化，主要是指在Linux系统中针对业务服务应用而进行的系统内核参数调整</strong></p>
<p>将以下参数追加到 <code>/etc/sysctl.conf</code>文件里</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat /etc/sysctl.conf </span><br><span class="line">net.ipv4.tcp_syn_retries = 1</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_synack_retries = 1</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_keepalive_time = 600</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_keepalive_probes = 3</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_keepalive_intvl =15</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_retries2 = 5</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_fin_timeout = 2</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_max_tw_buckets = 36000</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_tw_recycle = 1</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_tw_reuse = 1</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_max_orphans = 32768</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_syncookies = 1</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_max_syn_backlog = 16384</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_wmem = 8192 131072 16777216</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_rmem = 32768 131072 16777216</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_mem = 786432 1048576 1572864</span><br><span class="line"></span><br><span class="line">net.ipv4.ip_local_port_range = 1024 65000</span><br><span class="line"></span><br><span class="line">net.ipv4.ip_conntrack_max = 65536</span><br><span class="line"></span><br><span class="line">net.ipv4.netfilter.ip_conntrack_max=65536</span><br><span class="line"></span><br><span class="line">net.ipv4.netfilter.ip_conntrack_tcp_timeout_established=180</span><br><span class="line"></span><br><span class="line">net.core.somaxconn = 16384</span><br><span class="line"></span><br><span class="line">net.core.netdev_max_backlog = 16384</span><br></pre></td></tr></table></figure>

<p>之后再执行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# sysctl -p			#读取/etc/sysctl.conf文件里的参数</span><br><span class="line">net.ipv4.tcp_syn_retries = 1</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_synack_retries = 1</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_keepalive_time = 600</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_keepalive_probes = 3</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_keepalive_intvl =15</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_retries2 = 5</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_fin_timeout = 2</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_max_tw_buckets = 36000</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_tw_recycle = 1</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_tw_reuse = 1</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_max_orphans = 32768</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_syncookies = 1</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_max_syn_backlog = 16384</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_wmem = 8192 131072 16777216</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_rmem = 32768 131072 16777216</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_mem = 786432 1048576 1572864</span><br><span class="line"></span><br><span class="line">net.ipv4.ip_local_port_range = 1024 65000</span><br><span class="line"></span><br><span class="line">net.ipv4.ip_conntrack_max = 65536</span><br><span class="line"></span><br><span class="line">net.ipv4.netfilter.ip_conntrack_max=65536</span><br><span class="line"></span><br><span class="line">net.ipv4.netfilter.ip_conntrack_tcp_timeout_established=180</span><br><span class="line"></span><br><span class="line">net.core.somaxconn = 16384</span><br><span class="line"></span><br><span class="line">net.core.netdev_max_backlog = 16384</span><br></pre></td></tr></table></figure>



<blockquote>
<p><strong>参数详解</strong></p>
</blockquote>
<p>网络相关的，即前面得加 <code>net.ipv4.</code></p>
<table>
<thead>
<tr>
<th>名称</th>
<th>默认值</th>
<th>建议值</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>tcp_syn_retries</td>
<td>5</td>
<td>1</td>
<td>对于一个新建连接，内核要发送多少个 SYN 连接请求才决定放弃。不应该大于255，默认值是5，对应于180秒左右时间。。(对于大负载而物理通信良好的网络而言,这个值偏高,可修改为2.这个值仅仅是针对对外的连接,对进来的连接,是由tcp_retries1决定的)</td>
</tr>
<tr>
<td>tcp_synack_retries</td>
<td>5</td>
<td>1</td>
<td>对于远端的连接请求SYN，内核会发送SYN ＋ ACK数据报，以确认收到上一个 SYN连接请求包。这是所谓的三次握手( threeway handshake)机制的第二个步骤。这里决定内核在放弃连接之前所送出的 SYN+ACK 数目。不应该大于255，默认值是5，对应于180秒左右时间</td>
</tr>
<tr>
<td>tcp_keepalive_time</td>
<td>7200</td>
<td>600</td>
<td>TCP发送keepalive探测消息的间隔时间（秒），用于确认TCP连接是否有效。防止两边建立连接但不发送数据的攻击。</td>
</tr>
<tr>
<td>tcp_keepalive_probes</td>
<td>9</td>
<td>3</td>
<td>TCP发送keepalive探测消息的间隔时间（秒），用于确认TCP连接是否有效。</td>
</tr>
<tr>
<td>tcp_keepalive_intvl</td>
<td>75</td>
<td>15</td>
<td>探测消息未获得响应时，重发该消息的间隔时间（秒）。默认值为75秒。 (对于普通应用来说,这个值有一些偏大,可以根据需要改小.特别是web类服务器需要改小该值,15是个比较合适的值)</td>
</tr>
<tr>
<td>tcp_retries1</td>
<td>3</td>
<td>3</td>
<td>放弃回应一个TCP连接请求前﹐需要进行多少次重试。RFC 规定最低的数值是3</td>
</tr>
<tr>
<td>tcp_retries2</td>
<td>15</td>
<td>5</td>
<td>在丢弃激活(已建立通讯状况)的TCP连接之前﹐需要进行多少次重试。默认值为15，根据RTO的值来决定，相当于13-30分钟(RFC1122规定，必须大于100秒).(这个值根据目前的网络设置,可以适当地改小,我的网络内修改为了5)</td>
</tr>
<tr>
<td>tcp_orphan_retries</td>
<td>7</td>
<td>3</td>
<td>在近端丢弃TCP连接之前﹐要进行多少次重试。默认值是7个﹐相当于 50秒 - 16分钟﹐视 RTO 而定。如果您的系统是负载很大的web服务器﹐那么也许需要降低该值﹐这类 sockets 可能会耗费大量的资源。另外参的考<strong>tcp_max_orphans</strong>。(事实上做NAT的时候,降低该值也是好处显著的,我本人的网络环境中降低该值为3)</td>
</tr>
<tr>
<td>tcp_fin_timeout</td>
<td>60</td>
<td>5</td>
<td>对于本端断开的socket连接，TCP保持在FIN-WAIT-2状态的时间。对方可能会断开连接或一直不结束连接或不可预料的进程死亡。默认值为 60 秒。</td>
</tr>
<tr>
<td>tcp_max_tw_buckets</td>
<td>180000</td>
<td>36000</td>
<td>系统在同时所处理的最大 timewait sockets 数目。如果超过此数的话﹐time-wait socket 会被立即砍除并且显示警告信息。之所以要设定这个限制﹐纯粹为了抵御那些简单的 DoS 攻击﹐不过﹐如果网络条件需要比默认值更多﹐则可以提高它(或许还要增加内存)。(事实上做NAT的时候最好可以适当地增加该值)</td>
</tr>
<tr>
<td>tcp_tw_recycle</td>
<td>0</td>
<td>1</td>
<td>打开快速 TIME-WAIT sockets 回收。除非得到技术专家的建议或要求﹐请不要随意修改这个值。(做NAT的时候，建议打开它)</td>
</tr>
<tr>
<td>tcp_tw_reuse</td>
<td>0</td>
<td>1</td>
<td>表示是否允许重新应用处于TIME-WAIT状态的socket用于新的TCP连接(这个对快速重启动某些服务,而启动后提示端口已经被使用的情形非常有帮助)</td>
</tr>
<tr>
<td>tcp_max_orphans</td>
<td>8192</td>
<td>32768</td>
<td>系统所能处理不属于任何进程的TCP sockets最大数量。假如超过这个数量﹐那么不属于任何进程的连接会被立即reset，并同时显示警告信息。之所以要设定这个限制﹐纯粹为了抵御那些简单的 DoS 攻击﹐千万不要依赖这个或是人为的降低这个限制。如果内存大更应该增加这个值。(这个值Redhat AS版本中设置为32768,但是很多防火墙修改的时候,建议该值修改为2000)</td>
</tr>
<tr>
<td>tcp_abort_on_overflow</td>
<td>0</td>
<td>0</td>
<td>当守护进程太忙而不能接受新的连接，就象对方发送reset消息，默认值是false。这意味着当溢出的原因是因为一个偶然的猝发，那么连接将恢复状态。只有在你确信守护进程真的不能完成连接请求时才打开该选项，该选项会影响客户的使用。(对待已经满载的sendmail,apache这类服务的时候,这个可以很快让客户端终止连接,可以给予服务程序处理已有连接的缓冲机会,所以很多防火墙上推荐打开它)</td>
</tr>
<tr>
<td>tcp_syncookies</td>
<td>0</td>
<td>1</td>
<td>只有在内核编译时选择了CONFIG_SYNCOOKIES时才会发生作用。当出现syn等候队列出现溢出时象对方发送syncookies。目的是为了防止syn flood攻击。</td>
</tr>
<tr>
<td>tcp_stdurg</td>
<td>0</td>
<td>0</td>
<td>使用 TCP urg pointer 字段中的主机请求解释功能。大部份的主机都使用老旧的 BSD解释，因此如果您在 Linux 打开它﹐或会导致不能和它们正确沟通。</td>
</tr>
<tr>
<td>tcp_max_syn_backlog</td>
<td>1024</td>
<td>16384</td>
<td>对于那些依然还未获得客户端确认的连接请求﹐需要保存在队列中最大数目。对于超过 128Mb 内存的系统﹐默认值是 1024 ﹐低于 128Mb 的则为 128。如果服务器经常出现过载﹐可以尝试增加这个数字。警告﹗假如您将此值设为大于 1024﹐最好修改include/net/tcp.h里面的TCP_SYNQ_HSIZE﹐以保持TCP_SYNQ_HSIZE*16(SYN Flood攻击利用TCP协议散布握手的缺陷，伪造虚假源IP地址发送大量TCP-SYN半打开连接到目标系统，最终导致目标系统Socket队列资源耗尽而无法接受新的连接。为了应付这种攻击，现代Unix系统中普遍采用多连接队列处理的方式来缓冲(而不是解决)这种攻击，是用一个基本队列处理正常的完全连接应用(Connect()和Accept() )，是用另一个队列单独存放半打开连接。这种双队列处理方式和其他一些系统内核措施(例如Syn-Cookies/Caches)联合应用时，能够比较有效的缓解小规模的SYN Flood攻击(事实证明)</td>
</tr>
<tr>
<td>tcp_window_scaling</td>
<td>1</td>
<td>1</td>
<td>该文件表示设置tcp/ip会话的滑动窗口大小是否可变。参数值为布尔值，为1时表示可变，为0时表示不可变。tcp/ip通常使用的窗口最大可达到 65535 字节，对于高速网络，该值可能太小，这时候如果启用了该功能，可以使tcp/ip滑动窗口大小增大数个数量级，从而提高数据传输的能力(RFC 1323)。（对普通地百M网络而言，关闭会降低开销，所以如果不是高速网络，可以考虑设置为0）</td>
</tr>
<tr>
<td>tcp_timestamps</td>
<td>1</td>
<td>1</td>
<td>Timestamps 用在其它一些东西中﹐可以防范那些伪造的 sequence 号码。一条1G的宽带线路或许会重遇到带 out-of-line数值的旧sequence 号码(假如它是由于上次产生的)。Timestamp 会让它知道这是个 ‘旧封包’。(该文件表示是否启用以一种比超时重发更精确的方法（RFC 1323）来启用对 RTT 的计算；为了实现更好的性能应该启用这个选项。)</td>
</tr>
<tr>
<td>tcp_sack</td>
<td>1</td>
<td>1</td>
<td>使用 Selective ACK﹐它可以用来查找特定的遗失的数据报— 因此有助于快速恢复状态。该文件表示是否启用有选择的应答（Selective Acknowledgment），这可以通过有选择地应答乱序接收到的报文来提高性能（这样可以让发送者只发送丢失的报文段）。(对于广域网通信来说这个选项应该启用，但是这会增加对 CPU 的占用。)</td>
</tr>
<tr>
<td>tcp_fack</td>
<td>1</td>
<td>1</td>
<td>打开FACK拥塞避免和快速重传功能。(注意，当<strong>tcp_sack</strong>设置为0的时候，这个值即使设置为1也无效)[这个是TCP连接靠谱的核心功能]</td>
</tr>
<tr>
<td>tcp_dsack</td>
<td>1</td>
<td>1</td>
<td>允许TCP发送”两个完全相同”的SACK。</td>
</tr>
<tr>
<td>tcp_ecn</td>
<td>0</td>
<td>0</td>
<td>TCP的直接拥塞通告功能。</td>
</tr>
<tr>
<td>tcp_reordering</td>
<td>3</td>
<td>6</td>
<td>TCP流中重排序的数据报最大数量。 (一般有看到推荐把这个数值略微调整大一些,比如5)</td>
</tr>
<tr>
<td>tcp_retrans_collapse</td>
<td>1</td>
<td>0</td>
<td>对于某些有bug的打印机提供针对其bug的兼容性。(一般不需要这个支持,可以关闭它)</td>
</tr>
<tr>
<td>tcp_wmem：              min   default  max</td>
<td>4096       16384 131072</td>
<td>8192    131072 16777216</td>
<td>发送缓存设置                                                               <strong>min</strong>：为TCP socket预留用于发送缓冲的内存最小值。每个tcp socket都可以在建议以后都可以使用它。默认值为4096(4K)。                                                                 <strong>default</strong>：为TCP socket预留用于发送缓冲的内存数量，默认情况下该值会影响其它协议使用的net.core.wmem_default 值，一般要低于net.core.wmem_default的值。默认值为16384(16K)。<strong>max</strong>: 用于TCP socket发送缓冲的内存最大值。该值不会影响net.core.wmem_max，”静态”选择参数SO_SNDBUF则不受该值影响。默认值为131072(128K)。（对于服务器而言，增加这个参数的值对于发送数据很有帮助,在我的网络环境中,修改为了51200 131072 204800）</td>
</tr>
<tr>
<td>tcp_rmem：                   min  default  max</td>
<td>4096 87380 174760</td>
<td>32768 131072 16777216</td>
<td>接收缓存设置，同tcp_wmem</td>
</tr>
<tr>
<td>tcp_mem：                         low  pressure  high</td>
<td>根据内存计算</td>
<td>786432   1048576  1572864</td>
<td>确定 TCP 栈应该如何反映内存使用                                                           <strong>low</strong>：当TCP使用了低于该值的内存页面数时，TCP不会考虑释放内存。即低于此值没有内存压力。(理想情况下，这个值应与指定给 tcp_wmem 的第 2 个值相匹配 - 这第 2 个值表明，最大页面大小乘以最大并发请求数除以页大小 (131072 * 300 / 4096)。 )               <strong>pressure</strong>：当TCP使用了超过该值的内存页面数量时，TCP试图稳定其内存使用，进入pressure模式，当内存消耗低于low值时则退出pressure状态。(理想情况下这个值应该是 TCP 可以使用的总缓冲区大小的最大值 (204800 * 300 / 4096)。 )                                           <strong>high</strong>：允许所有tcp sockets用于排队缓冲数据报的页面量。(如果超过这个值，TCP 连接将被拒绝，这就是为什么不要令其过于保守 (512000 * 300 / 4096) 的原因了。 在这种情况下，提供的价值很大，它能处理很多连接，是所预期的 2.5 倍；或者使现有连接能够传输 2.5 倍的数据。 我的网络里为192000 300000 732000)                            <strong>一般情况下这些值是在系统启动时根据系统内存数量计算得到的。</strong></td>
</tr>
<tr>
<td>tcp_app_win</td>
<td>31</td>
<td>31</td>
<td>保留max(window/2^tcp_app_win, mss)数量的窗口由于应用缓冲。当为0时表示不需要缓冲。</td>
</tr>
<tr>
<td>tcp_adv_win_scale</td>
<td>2</td>
<td>2</td>
<td>计算缓冲开销bytes/2^tcp_adv_win_scale(如果tcp_adv_win_scale &gt; 0)或者bytes-bytes/2^(-tcp_adv_win_scale)(如果tcp_adv_win_scale BOOLEAN&gt;0)</td>
</tr>
<tr>
<td>tcp_low_latency</td>
<td>0</td>
<td>0</td>
<td>允许 TCP/IP 栈适应在高吞吐量情况下低延时的情况；这个选项一般情形是的禁用。(但在构建Beowulf 集群的时候,打开它很有帮助)</td>
</tr>
<tr>
<td>tcp_westwood</td>
<td>0</td>
<td>0</td>
<td>启用发送者端的拥塞控制算法，它可以维护对吞吐量的评估，并试图对带宽的整体利用情况进行优化；对于 WAN 通信来说应该启用这个选项。</td>
</tr>
<tr>
<td>tcp_bic</td>
<td>0</td>
<td>0</td>
<td>为快速长距离网络启用 Binary Increase Congestion；这样可以更好地利用以 GB 速度进行操作的链接；对于 WAN 通信应该启用这个选项。</td>
</tr>
<tr>
<td>ip_forward</td>
<td>0</td>
<td>-</td>
<td>NAT必须开启IP转发支持，则该值写1</td>
</tr>
<tr>
<td>ip_local_port_range: min  max</td>
<td>32768 61000</td>
<td>1024 65000</td>
<td>表示用于向外连接的端口范围，默认比较小，这个范围同样会间接用于NAT表规模。</td>
</tr>
<tr>
<td>ip_conntrack_max</td>
<td>65535</td>
<td>65535</td>
<td>系统支持的最大ipv4连接数，默认65536（事实上这也是理论最大值），同时这个值和你的内存大小有关，如果内存128M，这个值最大8192，1G以上内存这个值都是默认65536</td>
</tr>
</tbody></table>
<h4 id="定时清理邮件垃圾"><a href="#定时清理邮件垃圾" class="headerlink" title="定时清理邮件垃圾"></a>定时清理邮件垃圾</h4><p>​    Postfix服务，因此邮件临时存放地点的路径为<code>/var/spool/postfix/maildrop/</code>，该目录很容易被垃圾文件填满，导致系统的inode数量不够用，从而无法存放文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# find /var/spool/postfix/maildrop -type f | xargs rm -f</span><br></pre></td></tr></table></figure>



<p>定时清理：配置脚本，每周日0点定时删除邮件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mkdir -p /server/scripts			#归档脚本</span><br><span class="line">[root@localhost ~]# echo '/usr/bin/find /var/spool/postfix/maildrop/ -type f |xargs rm -f' &gt; /sever/scripts/del_mail.sh</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# echo "0 0 * * 0  /bin/sh /sever/scripts/del_mail.sh &gt;/dev/null 2&gt;&amp;1" &gt;&gt; /var/spool/cron/root		</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# crontab -l</span><br><span class="line"><span class="meta">#</span><span class="bash">del mail_file by chen</span></span><br><span class="line">0 0 * * 0  /bin/sh /sever/scripts/del_mail.sh &gt;/dev/null 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# df -i					#查看磁盘inode总量、剩余量、使用量</span><br><span class="line">Filesystem               Inodes IUsed   IFree IUse% Mounted on</span><br><span class="line">/dev/mapper/centos-root 4192256 51539 4140717    2% /</span><br><span class="line">devtmpfs                 121445   385  121060    1% /dev</span><br><span class="line">tmpfs                    124487     1  124486    1% /dev/shm</span><br><span class="line">tmpfs                    124487   721  123766    1% /run</span><br><span class="line">tmpfs                    124487    16  124471    1% /sys/fs/cgroup</span><br><span class="line">/dev/sda1                524288   326  523962    1% /boot</span><br><span class="line">tmpfs                    124487     1  124486    1% /run/user/0</span><br></pre></td></tr></table></figure>



<h4 id="锁定关键系统文件"><a href="#锁定关键系统文件" class="headerlink" title="锁定关键系统文件"></a>锁定关键系统文件</h4><p><code>/etc/passwd</code> 文件存储<strong>用户基本信息</strong>，同时考虑到账户的安全性，将<strong>用户的密码信息</strong>存放另一个文件 /etc/shadow 中。本节要将的 <code>/etc/gshadow</code> 文件也是如此，<strong>组用户信息</strong>存储在 <code>/etc/group</code> 文件中，而将<strong>组用户的密码信息</strong>存储在 <code>/etc/gshadow</code> 文件中</p>
<p>上锁命令如下:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# chattr +i /etc/shadow /etc/passwd /etc/group /etc/gshadow /etc/inittab</span><br></pre></td></tr></table></figure>

<p><strong>注：上锁后，所有用户都不能对文件修改删除(包括root)</strong></p>
<p>解锁命令如下:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# chattr -i /etc/shadow /etc/passwd /etc/group /etc/gshadow /etc/inittab</span><br></pre></td></tr></table></figure>

<p><strong>注：上锁后，如需临时操作，可以解锁后对文件进行修改，之后再上锁</strong></p>
<p><strong>如果想更加安全，可以把chattr改名转移，防止被黑客利用。命令如下</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mv /usr/bin/chattr  /usr/bin/lock</span><br></pre></td></tr></table></figure>



<h4 id="禁止Linux系统被ping"><a href="#禁止Linux系统被ping" class="headerlink" title="禁止Linux系统被ping"></a>禁止Linux系统被ping</h4><p>此项优化不是必须的，而且有时我们自己也会通过ping来检查服务器是否异常，对于要求很高的中小企业服务器，设置禁止ping也是可以的。从安全角度来说，禁止ping还是会增加系统安全的。</p>
<p>禁止ping的命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# echo 'net.ipv4.icmp_echo_ingore_all=1' &gt;&gt; /etc/sysctl.conf</span><br><span class="line">[root@localhost ~]# sysctl -p</span><br><span class="line">net.ipv4.icmp_echo_ingore_all=1</span><br></pre></td></tr></table></figure>



<p><strong>其实这个禁止ping的方法不是最佳策略，因为禁止ping后，我们自己也无法通过ping检查了，比较好的策略是通过iptables设置让特定的IP可以ping，如让内网用户ping，其他外部用户不能ping</strong></p>
<blockquote>
<p><strong>优化总结</strong></p>
</blockquote>
<p><strong>一清、一精、一增；</strong></p>
<p><strong>两优、四设、七其他。</strong></p>
<hr>
<p>一清： 定时清理日志/var/spool/clientsqueue</p>
<p>一精： 精简开机启动服务</p>
<p>一增： 增大文件描述符</p>
<p>两优： linux内核参数的优化、yum源优化</p>
<p>四设：</p>
<p>设置系统的字符集、设置ssh登录限制</p>
<p>设置开机的提示信息与内核信息、设置block的大小(如<code>mkfs -t ext3 -b 4096 /dev/sda1</code>)</p>
<p>七其他：</p>
<p>文件系统优化、sync数据同步写入磁盘、不更新时间戳</p>
<p>锁定系统关键文件、时间同步、sudo集权管理</p>
<p>关闭防火墙和selinux</p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Chen Huihuang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://yoursite.com/posts/b0d4adaa/">http://yoursite.com/posts/b0d4adaa/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://yoursite.com" target="_blank">Dear</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%AE%89%E5%85%A8/">安全</a><a class="post-meta__tags" href="/tags/%E8%B0%83%E4%BC%98/">调优</a></div><div class="post_share"><div class="social-share" data-image="/img/post.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/posts/692cdb86/"><img class="prev_cover" data-src="http://img.stupy.xyz/PicGo/bg2.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Vmware启动黑屏补救数据</div></div></a></div><div class="next-post pull_right"><a href="/posts/a1303e41/"><img class="next_cover" data-src="http://img.stupy.xyz/PicGo/bg1.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">ssh连接原理及排错</div></div></a></div></nav></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By Chen Huihuang</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="icp"><a href="http://www.beian.miit.gov.cn/state/outPortal/loginPortal.action" target="_blank" rel="noopener"><img class="icp-icon" src="/img/icp.png"/><span>粤ICP备20029056号-1</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">简</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script id="ribbon_piao" mobile="false" src="/js/third-party/piao.js"></script><script id="canvas_nest" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="/js/third-party/canvas-nest.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script><script src="/js/third-party/click_heart.js"></script><script src="/js/third-party/ClickShowText.js"></script></body></html>